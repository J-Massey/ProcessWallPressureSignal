\documentclass[aspectratio=169,9pt]{beamer}
% Beamer layout
\setbeamersize{text margin left=0.4cm, text margin right=0.2cm}

% Math & fonts
\usepackage{amsmath,amssymb}
\usepackage{mathpazo}   % Palatino text + math

% Tables & units
\usepackage{booktabs}
\usepackage{siunitx}

% TikZ (one load, all libs)
\usepackage{tikz}
\usetikzlibrary{arrows.meta,calc,positioning,shapes.geometric,shapes.misc}

% Algorithms
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{float}

% Media
\usepackage{multimedia}
\usepackage{animate}

% Bibliography
\usepackage{natbib}


\newcommand{\shortdate}{\the\month-\the\day}
\graphicspath{{../../figures/.}}

\include{setup}
\definecolor{cardinalred}{RGB}{140,21,21}
%--- Custom footline
\setbeamertemplate{footline}{%
\begin{beamercolorbox}[wd=\paperwidth,ht=4ex,dp=2.5ex]{}
    \centering
    \makebox[0.32\paperwidth][l]{\scriptsize\texttt{Pipe. \shortdate}}
    \makebox[0.32\paperwidth][c]{\scriptsize\texttt{$^{\dag}$masseyj@stanford.edu}}
    \makebox[0.32\paperwidth][r]{\scriptsize\insertframenumber/\inserttotalframenumber}
  \end{beamercolorbox}
}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usetikzlibrary{arrows.meta,shapes.geometric,shapes.misc,positioning}

\tikzset{
  >={Stealth},
  proc/.style = {rectangle, rounded corners, draw, align=left, minimum height=8mm, text width=35mm, align=center},
  meas/.style    = {trapezium, trapezium left angle=70, trapezium right angle=110, draw, align=left, minimum height=8mm, text width=19mm, align=center},
  decision/.style = {diamond, aspect=2.2, draw, align=center, inner xsep=1.2ex, inner ysep=1ex, text width=2cm},
  smldec/.style = {diamond, aspect=2.2, draw, align=center, inner xsep=1.2ex, inner ysep=1ex, text width=19mm},
  terminator/.style = {ellipse, draw, align=center, minimum height=8mm, minimum width=16mm},
  line/.style  = {->, line width=0.6pt}
}


%--- Title info
\title{Pressure checks Wed. 09-01-2025}
\author{JMO Massey$^{\dag}$, F Cabrera-Booman, T Jaroslawski, JC Klewicki, BJ McKeon}
\institute{Center for Turbulence Research \\ Stanford University}
% \thanks{This work was supported by DARPA under the CHAOS program}
\date{\today}

\begin{document}

%--- Title page
\begin{frame}
    \setcounter{framenumber}{0}
    \titlepage
    \vfill
    {\scriptsize \centering Thanks to DARPA for funding this work.\par}
\end{frame}

% \begin{frame}
%   \frametitle{POA}
%   \begin{enumerate}
%     \item Focus on 50psi ph calibration signals
%     \item Show the raw signals
%     \begin{itemize}
%         \item Show loglog for 3 cases.
%         \item No noise, w. background noise, white noise ?
%     \end{itemize}
%     \item Show the spectra
%     \item Show with HP filtering
%     \item Apply transfer function and show the TF
%     \item Determine whether a LP filter can be applied at $f=2kHz$
%     \begin{itemize}
%         \item $T^+\equiv T u_\tau^2/\nu$
%         \item at 50psi $Re_\tau\approx 5000$ $u_\tau\approx 0.51$, $\nu\approx 1.43$
%         \item $T^+=20 \to f=948Hz$
%     \end{itemize}
%     \item 
%   \end{enumerate}
% \end{frame}

\begin{frame}
  \frametitle{Raw calibration signals}
  \begin{figure}
    \centering
    \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_ts_signals_50psi_nonoise.pdf}
    \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_ts_signals_50psi_noise.pdf}
    \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_ts_signals_50psi_noiseWN.pdf}
  \end{figure}
  \centering
  \textbf{Top left:} white noise, \textbf{top right:} \emph{only} facility noise, \textbf{bottom:} white noise + facility noise
\end{frame}

\begin{frame}
  \frametitle{Raw calibration spectra: welch, $N_{\rm bin}=2^{14}$, $t_{\rm seg}=0.33$s}
  \begin{figure}
    \centering
    \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_nonoise.pdf}
    \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_noise.pdf}
    \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_noiseWN.pdf}
  \end{figure}
  
  \centering
  The PH doesn't suppress anything below $f = 500[\rm Hz]$ ($T^+ \approx 40$)
\end{frame}

\begin{frame}
  \frametitle{The calibration noise adds up}
    \centering
    \includegraphics[width=0.8\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_nkd_fn_plus_nn.pdf}
\end{frame}

\begin{frame}
    \frametitle{White noise is needed to highlight required TF}
        \centering
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/H_50psi_nn.png}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/H_50psi_fn.png}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/H_50psi_an.png}
\end{frame}

\begin{frame}
    \frametitle{TF function between identical signals is 1}
        \centering
        \includegraphics[width=0.8\textwidth]{sanity/50psi/PH-NKD/H_50psi_same.png}
        
\end{frame}

\begin{frame}
    \frametitle{TF reconstructed spectra}
        \centering
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_nn_recon.pdf}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_fn_recon.pdf}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_an_recon.pdf}

      \centering
      There seems to be some low-end oddities in application of the TF. This could be due to the low-frequency resolution, try a HP\&LP filter.
\end{frame}

\begin{frame}
    \frametitle{Spectra w. HP \& LP filter}
    Filter at 0.1Hz and 2kHz corresponding to LP cutoff of $T^+=10$ at 50psi
        \centering
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_nn_filt.pdf}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_fn_filt.pdf}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_an_filt.pdf}
\end{frame}

\begin{frame}
    \frametitle{Do the TFs look reasonably similar after filtering?}
        \centering
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/H_50psi_nn_filt.png}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/H_50psi_fn_filt.png}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/H_50psi_an_filt.png}
\end{frame}

\begin{frame}
    \frametitle{TF reconstructed spectra with HP \& LP filter}
        \centering
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_nn_filt_recon.pdf}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_fn_filt_recon.pdf}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_an_filt_recon.pdf}

    There's no benefit of filtering the signals before calculating the TF
\end{frame}
% Check 

\begin{frame}
    \frametitle{In-situ measurements at 50psi}
        \centering
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_ts_signals_50psi_nf.pdf}
        \includegraphics[width=0.4\textwidth]{sanity/50psi/PH-NKD/calib_ts_signals_50psi_f.pdf}

        \centering
        \textbf{Left:} facility noise (no flow), \textbf{right:} flow on measurements.
\end{frame}

\begin{frame}
    \frametitle{In-situ spectra at 50psi}
        \centering
        \includegraphics[width=0.8\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_f.pdf}
\end{frame}

\begin{frame}
    \frametitle{In-situ spectra at 50psi, filtered at 0.1Hz and 2kHz}
        \centering
        \includegraphics[width=0.8\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_f_filt.pdf}
\end{frame}

\begin{frame}
    \frametitle{In-situ spectra at 50psi, filtered at 0.1Hz and 2kHz, corrected by TF}
        \centering
        \includegraphics[width=0.8\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_f_filt_TF.pdf}
\end{frame}

\begin{frame}
    \frametitle{Compare this corrected PH to the NC}
        \centering
        \includegraphics[width=0.8\textwidth]{sanity/50psi/PH-NKD/calib_spectra_50psi_flow_NC_PH.pdf}
\end{frame}
\begin{frame}
    \frametitle{We're getting somewhere, we have new data though}
        \centering
        \includegraphics[width=0.8\textwidth]{sanity/50psi/03_10/calib_spectra_50psi_f.pdf}
        
        \centering
        This looks better, but the sticking point is the noise rejection. I'll work on that next.
\end{frame}

\end{document}
